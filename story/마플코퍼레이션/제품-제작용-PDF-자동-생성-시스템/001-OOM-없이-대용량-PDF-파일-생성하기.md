# OOM 없이 대용량 PDF 파일 생성하기

## 문제 상황

- 지류 상품 제작용 PDF 파일 1개에는 평균 1,200장의 고화질 이미지가 들어갑니다.
- 라이브러리를 사용해 PDF 파일을 생성하는 경우 파일에 넣은 이미지 데이터가 파일을 생성하기 전까지 모두 메모리 공간에 존재하는 문제가 있습니다.
- 이미지 파일 데이터가 모두 메모리에 올라가면 OOM 문제가 발생합니다. 이 문제가 발생하지 않는 라이브러리를 찾지 못했습니다.

## 액션

- PDF 파일 스펙은 공개 표준입니다. 스펙을 분석해 직접 PDF 파일을 생성하기로 합니다.
- 이미지 출력, 텍스트 출력 기능의 사용법을 연구하고 테스트를 진행합니다.
- PDF 파일을 추상화한 객체를 Node.js의 Stream API와 async generator를 이용하여 비동기적으로 구현합니다.

## 결과

- 이제 이미지 데이터는 실제 사용되는 시점에 평가되고 이후 GC에 의해 메모리 공간에서 제거됩니다. 전체 데이터를 동기적으로 관리하지 않기 때문에 OOM 문제가 발생하지 않습니다.
