# DB 쿼리 최적화해서 API 속도 개선하기

## 문제

- 미국에서 열리는 블록체인 행사에 참여할 때 사용자에게 더 좋은 경험을 주기 위해 API 응답 속도를 단축해달라는 요청이 있었습니다.

## 액션

- 여러 방법의 하나로 DB 쿼리 수를 줄일 수 있는지 확인해 봤습니다.
- Prisma를 DB Client로 사용 중이었는데, nested reads를 사용하는 부분에서 파라미터값만 다른 같은 쿼리가 여러 번 요청 중인 것을 확인했습니다.
- 중복 쿼리가 발생하는 테이블에 대해 해당 테이블을 가리키는 FK만 조회하고 모든 FK값을 모아 한 번에 쿼리해서 Node.js 런타임에서 데이터를 재구성했습니다.

## 결과

- API 속도를 평균 160ms에서 평균 60ms로 개선했습니다.

## 관련 자료

- https://medium.com/@daengdaenglee/prisma-%EC%A1%B0%ED%9A%8C-%EC%B5%9C%EC%A0%81%ED%99%94-e17043266739
